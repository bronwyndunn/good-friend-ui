{"ast":null,"code":"import _regeneratorRuntime from \"/Users/hunterhouston/Desktop/action-sports-photography/photo-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/hunterhouston/Desktop/action-sports-photography/photo-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/hunterhouston/Desktop/action-sports-photography/photo-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/hunterhouston/Desktop/action-sports-photography/photo-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/hunterhouston/Desktop/action-sports-photography/photo-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/hunterhouston/Desktop/action-sports-photography/photo-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/Users/hunterhouston/Desktop/action-sports-photography/photo-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/hunterhouston/Desktop/action-sports-photography/photo-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _taggedTemplateLiteral from \"/Users/hunterhouston/Desktop/action-sports-photography/photo-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/Users/hunterhouston/Desktop/action-sports-photography/photo-frontend/src/components/Stripe/CheckoutForm.js\";\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    mutation Charge($input: PurchaseInput!) {\\n    \\tpurchase(input: $input)\\n    }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { Component } from 'react';\nimport { CardElement, injectStripe } from 'react-stripe-elements';\nimport gql from 'graphql-tag';\nimport { ApolloConsumer } from 'react-apollo';\nimport jsonwebtoken from 'jsonwebtoken';\nexport var VERIFY_CHARGE = gql(_templateObject());\n\nvar CheckoutForm =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(CheckoutForm, _Component);\n\n  function CheckoutForm(props) {\n    var _this;\n\n    _classCallCheck(this, CheckoutForm);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(CheckoutForm).call(this, props));\n    _this.state = {\n      complete: false\n    };\n    _this.submit = _this.submit.bind(_assertThisInitialized(_this));\n    _this.handleSuccess = _this.handleSuccess.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(CheckoutForm, [{\n    key: \"submit\",\n    value: function () {\n      var _submit = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var _ref, token;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return this.props.stripe.createToken({\n                  name: 'Name'\n                });\n\n              case 3:\n                _ref = _context.sent;\n                token = _ref.token;\n                return _context.abrupt(\"return\", token.id);\n\n              case 8:\n                _context.prev = 8;\n                _context.t0 = _context[\"catch\"](0);\n                return _context.abrupt(\"return\", _context.t0);\n\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 8]]);\n      }));\n\n      function submit() {\n        return _submit.apply(this, arguments);\n      }\n\n      return submit;\n    }()\n  }, {\n    key: \"handleSuccess\",\n    value: function handleSuccess() {\n      this.setState({\n        complete: true\n      });\n      this.props.props.clearCart();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      if (this.state.complete) return React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 34\n        },\n        __self: this\n      }, \"Purchase Complete\");\n      var playerState = this.props.props.playerState;\n\n      var _jsonwebtoken$decode = jsonwebtoken.decode(localStorage.getItem('token')),\n          email = _jsonwebtoken$decode.email;\n\n      var amount = playerState.amount * 25;\n      var photoIds = playerState.cartPhotoIds;\n      return React.createElement(ApolloConsumer, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 41\n        },\n        __self: this\n      }, function (client) {\n        return React.createElement(\"div\", {\n          className: \"checkout\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 43\n          },\n          __self: this\n        }, React.createElement(\"h3\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 44\n          },\n          __self: this\n        }, \"\".concat(playerState.amount, \" photos in your cart. Your total is $\").concat(amount, \".\")), React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 45\n          },\n          __self: this\n        }, \"Would you like to complete the purchase?\"), React.createElement(CardElement, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 46\n          },\n          __self: this\n        }), React.createElement(\"button\", {\n          className: \"stripe-button\",\n          onClick:\n          /*#__PURE__*/\n          _asyncToGenerator(\n          /*#__PURE__*/\n          _regeneratorRuntime.mark(function _callee2() {\n            var _ref3, data;\n\n            return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n              while (1) {\n                switch (_context2.prev = _context2.next) {\n                  case 0:\n                    _context2.t0 = client;\n                    _context2.t1 = VERIFY_CHARGE;\n                    _context2.t2 = email;\n                    _context2.t3 = amount;\n                    _context2.t4 = photoIds;\n                    _context2.next = 7;\n                    return _this2.submit();\n\n                  case 7:\n                    _context2.t5 = _context2.sent;\n                    _context2.t6 = {\n                      email: _context2.t2,\n                      amount: _context2.t3,\n                      photoIds: _context2.t4,\n                      token: _context2.t5\n                    };\n                    _context2.t7 = {\n                      input: _context2.t6\n                    };\n                    _context2.t8 = {\n                      mutation: _context2.t1,\n                      variables: _context2.t7\n                    };\n                    _context2.next = 13;\n                    return _context2.t0.mutate.call(_context2.t0, _context2.t8);\n\n                  case 13:\n                    _ref3 = _context2.sent;\n                    data = _ref3.data;\n                    if (data.purchase === 'success') _this2.handleSuccess();\n\n                  case 16:\n                  case \"end\":\n                    return _context2.stop();\n                }\n              }\n            }, _callee2);\n          })),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 47\n          },\n          __self: this\n        }, \"Complete Purchase\"));\n      });\n    }\n  }]);\n\n  return CheckoutForm;\n}(Component);\n\nexport default injectStripe(CheckoutForm);","map":{"version":3,"sources":["/Users/hunterhouston/Desktop/action-sports-photography/photo-frontend/src/components/Stripe/CheckoutForm.js"],"names":["React","Component","CardElement","injectStripe","gql","ApolloConsumer","jsonwebtoken","VERIFY_CHARGE","CheckoutForm","props","state","complete","submit","bind","handleSuccess","stripe","createToken","name","token","id","setState","clearCart","playerState","decode","localStorage","getItem","email","amount","photoIds","cartPhotoIds","client","input","mutation","variables","mutate","data","purchase"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { CardElement, injectStripe } from 'react-stripe-elements'\nimport gql from 'graphql-tag'\nimport { ApolloConsumer } from 'react-apollo'\nimport jsonwebtoken from 'jsonwebtoken'\n\nexport const VERIFY_CHARGE = gql`\n    mutation Charge($input: PurchaseInput!) {\n    \tpurchase(input: $input)\n    }\n`\nclass CheckoutForm extends Component {\n  constructor (props) {\n    super(props)\n    this.state = { complete: false }\n\n    this.submit = this.submit.bind(this)\n    this.handleSuccess = this.handleSuccess.bind(this)\n  }\n\n  async submit () {\n    try {\n      const { token } = await this.props.stripe.createToken({ name: 'Name' })\n      return token.id\n    } catch (er) { return er }\n  }\n\n  handleSuccess () {\n    this.setState({ complete: true })\n    this.props.props.clearCart()\n  }\n\n  render () {\n    if (this.state.complete) return <h1>Purchase Complete</h1>\n    const { playerState } = this.props.props\n    const { email } = jsonwebtoken.decode(localStorage.getItem('token'))\n    const amount = playerState.amount * 25\n    const photoIds = playerState.cartPhotoIds\n\n    return (\n      <ApolloConsumer>\n        {client => (\n          <div className='checkout'>\n            <h3>{`${playerState.amount} photos in your cart. Your total is $${amount}.`}</h3>\n            <p>Would you like to complete the purchase?</p>\n            <CardElement />\n            <button\n              className='stripe-button'\n              onClick={async () => {\n                const { data } = await client.mutate({\n                  mutation: VERIFY_CHARGE,\n                  variables: { input: { email, amount, photoIds, token: await this.submit() } }\n                })\n                if (data.purchase === 'success') this.handleSuccess()\n              }}\n            >\n              Complete Purchase\n            </button>\n          </div>\n        )}\n      </ApolloConsumer>\n    )\n  }\n}\n\nexport default injectStripe(CheckoutForm)\n"]},"metadata":{},"sourceType":"module"}